<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Management</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
/* Add your custom CSS styles here */
</style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <div class="navbar-nav ms-auto">
                <span class="nav-item nav-link">Welcome, ${sessionScope.user.fullname}</span>
                <a class="nav-item nav-link" href="${pageContext.request.contextPath}/home">Home</a>
                <a class="nav-item nav-link" href="${pageContext.request.contextPath}/logout">Logout</a>
            </div>
        </div>
    </div>
</nav>

<div class="container mt-5">
    <c:if test="${not empty message}">
        <div class="alert alert-success">${message}</div>
    </c:if>
    <c:if test="${not empty error}">
        <div class="alert alert-danger">${error}</div>
    </c:if>
    <h1 class="text-center">User Manager</h1>
    <c:if test="${not empty welcomeMessage}">
        <div class="alert alert-info">${welcomeMessage}</div>
    </c:if>

    <form id="userForm" method="post" action="${pageContext.request.contextPath}/user/${user.id == null ? 'create' : 'update'}">
        <div class="mb-3">
            <label for="id" class="form-label fw-bold">ID</label>
            <input type="text" class="form-control" id="id" name="id" value="${user.id}" required>
        </div>
        <div class="mb-3">
            <label for="password" class="form-label fw-bold">Password</label>
            <input type="password" class="form-control" id="password" name="password" value="${user.password}" required>
        </div>
        <div class="mb-3">
            <label for="fullname" class="form-label fw-bold">Full Name</label>
            <input type="text" class="form-control" id="fullname" name="fullname" value="${user.fullname}" required>
        </div>
        <div class="mb-3">
            <label for="email" class="form-label fw-bold">Email</label>
            <input type="email" class="form-control" id="email" name="email" value="${user.email}" required>
        </div>
        <div class="mb-3">
            <label class="form-label fw-bold">Role</label>
            <div>
                <input id="admin" type="radio" name="admin" value="true" ${user.admin ? 'checked' : ''}>
                <label for="admin">Admin</label>
                <input id="user" type="radio" name="admin" value="false" ${!user.admin ? 'checked' : ''}>
                <label for="user">User</label>
            </div>
        </div>
        <c:if test="${sessionScope.user.admin}">
            <button type="submit" name="action" value="create" class="btn btn-success">Create</button>
            <button type="submit" name="action" value="update" class="btn btn-warning">Update</button>
            <button type="submit" name="action" value="delete" class="btn btn-danger">Delete</button>
            <button type="submit" name="action" value="reset" class="btn btn-info">Reset</button>
        </c:if>
    </form>
</div>

<div class="container mt-5">
    <h2>User List</h2>

    <form action="${pageContext.request.contextPath}/user/index" method="get" class="d-flex mb-4">
        <input class="form-control me-2" type="search" placeholder="Search by Full Name" aria-label="Search" name="fullname" value="${param.fullname != null ? param.fullname : ''}">
        <input class="form-control me-2" type="email" placeholder="Search by Email" aria-label="Search" name="email" value="${param.email != null ? param.email : ''}">
        <select class="form-select me-2" name="role">
            <option value="">Select Role</option>
            <option value="true" ${param.role == 'true' ? 'selected' :